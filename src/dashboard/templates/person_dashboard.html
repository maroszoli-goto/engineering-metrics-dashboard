<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ username }} - Metrics Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; color: #2c3e50; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 30px; }
        h1 { font-size: 32px; margin-bottom: 10px; }
        .subtitle { color: #7f8c8d; font-size: 14px; }
        .nav { margin: 20px 0; }
        .nav a { color: #3498db; text-decoration: none; margin-right: 20px; }
        .nav a:hover { text-decoration: underline; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card h2 { font-size: 20px; margin-bottom: 15px; color: #34495e; }
        .metric-value { font-size: 36px; font-weight: 600; color: #3498db; margin-bottom: 5px; }
        .metric-label { color: #7f8c8d; font-size: 14px; }
        .section-title { margin: 40px 0 15px 0; font-size: 24px; }
        .period-selector { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .period-selector label { font-weight: 600; margin-right: 15px; }
        .period-selector select { padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>{{ username }}</h1>
            {% if team_name %}
            <p class="subtitle">Team: {{ team_name }}</p>
            {% endif %}
            <p class="subtitle">Period: {{ person_data.period.start[:10] if person_data.period.start else 'N/A' }} to {{ person_data.period.end[:10] if person_data.period.end else 'N/A' }}</p>
            <p class="subtitle">Last updated: {{ updated_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
            <div class="nav">
                <a href="/">‚Üê Home</a>
                {% if team_name %}
                <a href="/team/{{ team_name }}">{{ team_name }} Team</a>
                {% endif %}
            </div>
        </header>

        <h2 class="section-title">GitHub Activity</h2>
        <div class="metrics-grid">
            <div class="card">
                <h2>Pull Requests</h2>
                <div class="metric-value">{{ person_data.github.prs_created }}</div>
                <div class="metric-label">PRs Created</div>
                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">
                    Merged: {{ person_data.github.prs_merged }} ({{ "%.0f"|format(person_data.github.merge_rate * 100) }}%)
                </div>
            </div>

            <div class="card">
                <h2>Code Reviews</h2>
                <div class="metric-value">{{ person_data.github.reviews_given }}</div>
                <div class="metric-label">Reviews Given</div>
                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">
                    PRs reviewed: {{ person_data.github.prs_reviewed }}
                </div>
            </div>

            <div class="card">
                <h2>Commits</h2>
                <div class="metric-value">{{ person_data.github.commits }}</div>
                <div class="metric-label">Total Commits</div>
            </div>

            <div class="card">
                <h2>Code Changes</h2>
                <div class="metric-value">{{ person_data.github.lines_added + person_data.github.lines_deleted }}</div>
                <div class="metric-label">Total Lines Changed</div>
                <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">
                    +{{ person_data.github.lines_added }} / -{{ person_data.github.lines_deleted }}
                </div>
            </div>

            <div class="card">
                <h2>PR Cycle Time</h2>
                <div class="metric-value">{{ "%.1f"|format(person_data.github.avg_pr_cycle_time) }}h</div>
                <div class="metric-label">Avg Time to Merge</div>
            </div>

            <div class="card">
                <h2>Review Speed</h2>
                <div class="metric-value">{{ "%.1f"|format(person_data.github.avg_time_to_review) }}h</div>
                <div class="metric-label">Avg Time to First Review</div>
            </div>
        </div>

        {% if person_data.jira and person_data.jira.completed > 0 %}
        <h2 class="section-title">Jira Activity</h2>
        <div class="metrics-grid">
            <div class="card">
                <h2>Issues Completed</h2>
                <div class="metric-value">{{ person_data.jira.completed }}</div>
                <div class="metric-label">Resolved Issues</div>
            </div>

            <div class="card">
                <h2>Work In Progress</h2>
                <div class="metric-value">{{ person_data.jira.in_progress }}</div>
                <div class="metric-label">Active Issues</div>
            </div>

            <div class="card">
                <h2>Avg Cycle Time</h2>
                <div class="metric-value">{{ "%.1f"|format(person_data.jira.avg_cycle_time) }}h</div>
                <div class="metric-label">Issue Resolution Time</div>
            </div>
        </div>

        {% if person_data.jira.types %}
        <div class="card">
            <h2>Issue Types</h2>
            <div id="issue-types-chart"></div>
            <script>
                var data = [{
                    labels: Object.keys({{ person_data.jira.types|tojson }}),
                    values: Object.values({{ person_data.jira.types|tojson }}),
                    type: 'pie',
                    marker: {colors: ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6']}
                }];
                var layout = {
                    title: 'Issues by Type',
                    height: 300
                };
                Plotly.newPlot('issue-types-chart', data, layout);
            </script>
        </div>
        {% endif %}
        {% endif %}

        <div class="card" style="margin-top: 30px;">
            <h2>Activity Summary</h2>
            <p style="line-height: 1.6; color: #555;">
                <strong>{{ username }}</strong> has been actively contributing to the team during this period.
                {% if person_data.github.prs_created > 0 %}
                Created <strong>{{ person_data.github.prs_created }}</strong> pull requests with a
                <strong>{{ "%.0f"|format(person_data.github.merge_rate * 100) }}%</strong> merge rate.
                {% endif %}
                {% if person_data.github.reviews_given > 0 %}
                Participated in code reviews, providing <strong>{{ person_data.github.reviews_given }}</strong> reviews across
                <strong>{{ person_data.github.prs_reviewed }}</strong> different pull requests.
                {% endif %}
                {% if person_data.github.commits > 0 %}
                Made <strong>{{ person_data.github.commits }}</strong> commits, contributing
                <strong>+{{ person_data.github.lines_added }}</strong> and removing
                <strong>-{{ person_data.github.lines_deleted }}</strong> lines of code.
                {% endif %}
            </p>
        </div>
    </div>
</body>
</html>
